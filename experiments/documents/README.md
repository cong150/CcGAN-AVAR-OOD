# CcGAN-AVAR OODæ³›åŒ–å®žéªŒ - å®Œæ•´æŒ‡å—

## ðŸŽ¯ **ç ”ç©¶ç›®æ ‡**

éªŒè¯**å®Œæ•´CcGAN-AVAR**åœ¨OODåœºæ™¯ä¸‹çš„é—®é¢˜ï¼Œå¹¶æµ‹è¯•ç®€å•æ··åˆè®­ç»ƒç­–ç•¥çš„æ•ˆæžœã€‚

### **æ ¸å¿ƒé—®é¢˜**
æ¡ä»¶ç”Ÿæˆæ¨¡åž‹ï¼ˆCcGANï¼‰åœ¨è®­ç»ƒåŒºåŸŸå¤–ï¼ˆOODï¼‰æ³›åŒ–èƒ½åŠ›å·®ã€‚

### **å®žéªŒæ€è·¯**
```
é—®é¢˜å‘çŽ°ï¼šåªç”¨IDæ•°æ®ï¼ˆ0-45åº¦ï¼‰è®­ç»ƒ â†’ OODåŒºåŸŸï¼ˆ45-90åº¦ï¼‰ç”Ÿæˆå¤±è´¥
    â†“
ç®€å•å°è¯•ï¼šåŠ å…¥å°‘é‡OODæ•°æ®ï¼ˆæ¯è§’åº¦50å¼ ï¼‰æ··åˆè®­ç»ƒ
    â†“
å®žéªŒéªŒè¯ï¼šè¿™ç§ç®€å•æ··åˆæ˜¯å¦è¶³å¤Ÿï¼Ÿ
    â†“
æœªæ¥å·¥ä½œï¼šéœ€è¦æ›´sophisticatedçš„æ–¹æ³•
```

---

## ðŸ“Š **å®žéªŒè®¾è®¡ï¼ˆ3ä¸ªå¯¹æ¯”å®žéªŒï¼‰**

| å®žéªŒ | è®­ç»ƒæ•°æ® | ç›®çš„ | é¢„æœŸç»“æžœ |
|------|---------|------|---------|
| **Baseline** | åªç”¨0-45åº¦ | è¯æ˜ŽOODé—®é¢˜å­˜åœ¨ | OODåŒºåŸŸç”Ÿæˆå¤±è´¥ âŒ |
| **Simple-Mix** | 0-45å…¨éƒ¨ + 45-90å°‘é‡(50å¼ /è§’åº¦) | éªŒè¯ç®€å•æ··åˆæ˜¯å¦è¶³å¤Ÿ | æœ‰æ”¹å–„ä½†ä¸å¤Ÿ âš ï¸ |
| **Oracle** | 0-90åº¦å…¨éƒ¨æ•°æ® | æ€§èƒ½ä¸Šç•Œå‚è€ƒ | å…¨èŒƒå›´ç”Ÿæˆå¥½ âœ… |

### **ç ”ç©¶æ„ä¹‰**
- **Baseline**: ç¡®è®¤é—®é¢˜ä¸¥é‡æ€§
- **Simple-Mix**: è¯æ˜Žç®€å•æ–¹æ³•ä¸å¤Ÿï¼ˆmotivateæœªæ¥æ”¹è¿›ï¼‰
- **Oracle**: å±•ç¤ºç†æƒ³æƒ…å†µï¼ˆå¦‚æžœæœ‰è¶³å¤Ÿæ•°æ®ï¼‰

---

## âš¡ **å¿«é€Ÿå¼€å§‹ï¼ˆ5æ­¥å®Œæˆï¼‰**

### **å‰ç½®å‡†å¤‡**
- âœ… GPUæ˜¾å­˜ â‰¥ 10GB
- âœ… æ•°æ®é›†: `RC-49_64x64.h5`
- âœ… PythonçŽ¯å¢ƒå·²é…ç½®

### **æ‰§è¡Œæ­¥éª¤**

```bash
cd experiments

# === å¿…åšæ­¥éª¤ ===

# æ­¥éª¤1ï¼šè®­ç»ƒè¾…åŠ©å›žå½’æ¨¡åž‹ï¼ˆå¿…é¡»ï¼çº¦1-2å°æ—¶ï¼‰
bash step1_train_aux_regression.sh

# æ­¥éª¤2ï¼šå‡†å¤‡æ··åˆæ•°æ®é›†ï¼ˆçº¦1åˆ†é’Ÿï¼‰
bash step2_prepare_data.sh

# æ­¥éª¤3ï¼šè®­ç»ƒBaselineï¼ˆçº¦3-5å°æ—¶ï¼‰
bash step3_baseline_id_only.sh

# æ­¥éª¤4ï¼šè®­ç»ƒSimple-Mixï¼ˆçº¦3-5å°æ—¶ï¼‰
bash step4_simple_mix.sh

# æ­¥éª¤5ï¼šè®­ç»ƒOracleï¼ˆçº¦3-5å°æ—¶ï¼‰
bash step5_oracle_full.sh
```

**æ€»æ—¶é—´**ï¼šçº¦10-17å°æ—¶

**æç¤º**ï¼š
- æ¯ä¸ªè„šæœ¬éƒ½æ”¯æŒæ¢å¤è®­ç»ƒï¼ˆä¿®æ”¹`RESUME_ITER`å‚æ•°ï¼‰
- å»ºè®®ä½¿ç”¨tmux/screené˜²æ­¢SSHæ–­å¼€å¯¼è‡´ä¸­æ–­

---

## ðŸ”§ **é…ç½®ä¿®æ”¹**

æ¯ä¸ªè„šæœ¬å¼€å¤´ä¿®æ”¹è¿™ä¸¤è¡Œï¼š

```bash
ROOT_PATH="/home/wxc/nuist-lab/CcGAN-AVAR-OOD"  # æ”¹æˆä½ çš„é¡¹ç›®è·¯å¾„
DATA_PATH="/home/wxc/datasets"                   # æ”¹æˆä½ çš„æ•°æ®è·¯å¾„
```

---

## ðŸ“ **è¾“å‡ºç»“æž„**

```
output/RC-49_64/
â”œâ”€â”€ aux_reg_model/                    # è¾…åŠ©å›žå½’æ¨¡åž‹
â”‚   â””â”€â”€ ckpt_resnet18_epoch_200.pth
â”œâ”€â”€ baseline_id_only/                 # å®žéªŒ1
â”‚   â””â”€â”€ results/
â”‚       â”œâ”€â”€ ckpt_niter_*.pth         # æ¯10000æ¬¡ä¿å­˜
â”‚       â”œâ”€â”€ imgs_in_train/           # è®­ç»ƒè¿‡ç¨‹æ ·æœ¬ï¼ˆæ¯5000æ¬¡ï¼‰
â”‚       â”œâ”€â”€ fake_data/               # è¯„ä¼°æ—¶ç”Ÿæˆï¼ˆè®­ç»ƒæ—¶ä¸ºç©ºï¼‰
â”‚       â””â”€â”€ log_loss_niters*.txt     # è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ simple_mix_50/                    # å®žéªŒ2
â”‚   â””â”€â”€ results/
â”‚       â”œâ”€â”€ ckpt_niter_*.pth
â”‚       â”œâ”€â”€ imgs_in_train/
â”‚       â””â”€â”€ fake_data/
â””â”€â”€ oracle_full/                      # å®žéªŒ3
    â””â”€â”€ results/
        â”œâ”€â”€ ckpt_niter_*.pth
        â”œâ”€â”€ imgs_in_train/
        â””â”€â”€ fake_data/

experiments/
â”œâ”€â”€ output_step1_aux_regression.txt   # æ­¥éª¤1è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ output_step3_baseline.txt         # æ­¥éª¤3è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ output_step4_ours.txt             # æ­¥éª¤4è®­ç»ƒæ—¥å¿—
â””â”€â”€ output_step5_oracle.txt           # æ­¥éª¤5è®­ç»ƒæ—¥å¿—
```

---

## ðŸ‘€ **æŸ¥çœ‹ç»“æžœ**

### **æ–¹æ³•1ï¼šæŸ¥çœ‹è®­ç»ƒè¿‡ç¨‹æ ·æœ¬**

```bash
# è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ ·æœ¬ï¼ˆè®­ç»ƒæ—¶è‡ªåŠ¨ç”Ÿæˆï¼‰
# Baselineï¼ˆåº”è¯¥åªåœ¨0-45åº¦å¥½ï¼‰
ls output/RC-49_64/baseline_id_only/imgs_in_train/*.png

# Simple-Mixï¼ˆåº”è¯¥æ¯”Baselineå¥½ï¼Œä½†å¯èƒ½ä¸å¤Ÿç†æƒ³ï¼‰
ls output/RC-49_64/simple_mix_50/imgs_in_train/*.png

# Oracleï¼ˆåº”è¯¥å…¨èŒƒå›´éƒ½å¥½ï¼‰
ls output/RC-49_64/oracle_full/imgs_in_train/*.png

# æ³¨æ„ï¼šfake_dataç›®å½•éœ€è¦è¿è¡Œè¯„ä¼°æ‰ä¼šæœ‰æ•°æ®
# è®­ç»ƒæ—¶åªç”Ÿæˆimgs_in_trainç›®å½•çš„æ ·æœ¬
```

### **æ–¹æ³•2ï¼šå¯¹æ¯”åˆ†æž**

ç”¨å›¾åƒæŸ¥çœ‹å™¨æ‰“å¼€å¯¹åº”çš„PNGæ–‡ä»¶ï¼Œè§‚å¯Ÿï¼š

**Baselineï¼ˆ0-45åº¦è®­ç»ƒï¼‰**:
- 0-30åº¦: â­â­â­â­â­ å®Œç¾Ž
- 30-45åº¦: â­â­â­â­ å¾ˆå¥½
- 45-60åº¦: â­â­ æ˜Žæ˜¾ä¸‹é™
- 60-90åº¦: â­ å¾ˆå·®/å´©æºƒ

**Simple-Mixï¼ˆæ··åˆè®­ç»ƒï¼‰**:
- 0-30åº¦: â­â­â­â­â­ å®Œç¾Ž
- 30-45åº¦: â­â­â­â­â­ å®Œç¾Ž
- 45-60åº¦: â­â­â­ æœ‰æ”¹å–„
- 60-90åº¦: â­â­ æœ‰æ”¹å–„ä½†ä¸å¤Ÿ

**Oracleï¼ˆå…¨èŒƒå›´è®­ç»ƒï¼‰**:
- 0-90åº¦: â­â­â­â­â­ å…¨èŒƒå›´å®Œç¾Ž

---

## ðŸ” **è¾…åŠ©å›žå½’æ¨¡åž‹è¯¦è§£**

### **ä¸ºä»€ä¹ˆéœ€è¦å…ˆè®­ç»ƒå®ƒï¼Ÿ**

**ä½œç”¨**ï¼šç»™ç”Ÿæˆå™¨æä¾›é¢å¤–çš„ç›‘ç£ä¿¡å·

```python
# å·¥ä½œåŽŸç†ï¼š
1. è®­ç»ƒå‰ï¼šç”¨0-90åº¦çœŸå®žå›¾åƒè®­ç»ƒResNet18ï¼Œå­¦ä¼š"çœ‹å›¾è¯†åˆ«è§’åº¦"
2. è®­ç»ƒGANæ—¶ï¼š
   - ç”Ÿæˆå™¨ç”Ÿæˆä¸€å¼ "30åº¦"çš„å›¾åƒ
   - è¾…åŠ©å›žå½’ç½‘ç»œé¢„æµ‹"è¿™å¼ å›¾åƒçœ‹èµ·æ¥åƒå¤šå°‘åº¦ï¼Ÿ"
   - å¦‚æžœé¢„æµ‹ä¸æ˜¯30åº¦ â†’ æƒ©ç½šç”Ÿæˆå™¨
   - ç›®çš„ï¼šç¡®ä¿ç”Ÿæˆå›¾åƒåœ¨è¯­ä¹‰ä¸Šä¸Žç›®æ ‡è§’åº¦ä¸€è‡´
```

**æ³¨æ„**ï¼š
- âŒ ä¸æ˜¯ç”¨æ¥ç¡®å®šé‚»åŸŸèŒƒå›´
- âŒ ä¸æ˜¯ç”¨æ¥è®¡ç®—æ ·æœ¬æƒé‡
- âœ… æ˜¯ç”¨æ¥æä¾›é¢å¤–ç›‘ç£ï¼ˆè¾…åŠ©æŸå¤±ï¼‰

---

## ðŸ”§ **å‚æ•°è°ƒæ•´**

### **1. OODæ ·æœ¬æ•°é‡**

ä¿®æ”¹`step2_prepare_data.sh`:
```bash
--ood_samples_per_label 50    # æ”¹ä¸º10, 100, 200ç­‰
```

å¯ä»¥å°è¯•ä¸åŒæ•°é‡çœ‹æ•ˆæžœã€‚

### **2. å¿«é€Ÿæµ‹è¯•**

ä¿®æ”¹è®­ç»ƒè„šæœ¬:
```bash
NITERS=30000    # æ”¹ä¸ºNITERS=5000
```

### **3. æ˜¾å­˜ä¸è¶³**

ä¿®æ”¹è®­ç»ƒè„šæœ¬:
```bash
BATCH_SIZE_G=256    # æ”¹ä¸º128æˆ–64
BATCH_SIZE_D=256    # æ”¹ä¸º128æˆ–64
```

### **4. å¤šGPUè®­ç»ƒ**

ä¿®æ”¹è®­ç»ƒè„šæœ¬å¼€å¤´:
```bash
# å•GPUï¼ˆé»˜è®¤ï¼‰
export CUDA_VISIBLE_DEVICES=0

# å¤šGPUï¼ˆä¾‹å¦‚ä½¿ç”¨GPU 0,1,2,3ï¼‰
export CUDA_VISIBLE_DEVICES=0,1,2,3

# è¯„ä¼°ç½‘ç»œä¼šè‡ªåŠ¨ä½¿ç”¨DataParallel
# ä½†ä¸»è®­ç»ƒé€»è¾‘ç›®å‰æ˜¯å•GPU
```

---

## â“ **å¸¸è§é—®é¢˜**

### Q1: æ‰¾ä¸åˆ°è¾…åŠ©å›žå½’æ¨¡åž‹
**A**: ç¡®ä¿å…ˆæ‰§è¡Œæ­¥éª¤1ï¼Œç”Ÿæˆï¼š
```
output/RC-49_64/aux_reg_model/ckpt_resnet18_epoch_200.pth
```

### Q2: CUDA out of memory
**A**: å‡å°batch sizeï¼ˆè§ä¸Šé¢"å‚æ•°è°ƒæ•´"ï¼‰

### Q3: æ­¥éª¤4æ‰¾ä¸åˆ°æ··åˆæ•°æ®é›†
**A**: ç¡®ä¿å…ˆæ‰§è¡Œæ­¥éª¤2ï¼Œç”Ÿæˆï¼š
```
experiments/data/RC-49_mixed_id_full_ood_50_64x64.h5
```

### Q4: è®­ç»ƒä¸­æ–­äº†æ€Žä¹ˆåŠžï¼Ÿ
**A**: ä¿®æ”¹è„šæœ¬ä¸­çš„`RESUME_ITER`å‚æ•°ï¼š
```bash
# ä¾‹å¦‚ä»Ž20000æ¬¡è¿­ä»£ç»§ç»­
RESUME_ITER=20000  # é»˜è®¤æ˜¯0
```
å‰ææ˜¯å¯¹åº”çš„checkpointå­˜åœ¨ï¼ˆå¦‚`ckpt_niter_20000.pth`ï¼‰

### Q5: è®­ç»ƒlosså‡ºçŽ°NaN
**A**: 
- é™ä½Žå­¦ä¹ çŽ‡
- æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®åŠ è½½

---

## ðŸ“ **å®žéªŒè®°å½•å»ºè®®**

å»ºè®®åˆ›å»ºæ—¥å¿—è®°å½•å®žéªŒç»“æžœï¼š

```bash
cat > experiments/experiment_log.md << 'EOF'
# å®žéªŒè®°å½•

## é…ç½®
- æ—¥æœŸï¼š2025-XX-XX
- GPUï¼šXXX
- OODæ ·æœ¬æ•°ï¼š50å¼ /è§’åº¦

## å®žéªŒ1: Baselineï¼ˆåªç”¨0-45åº¦ï¼‰
- è®­ç»ƒæ—¶é—´ï¼šXå°æ—¶
- è§‚å¯Ÿï¼š
  - IDåŒºåŸŸï¼ˆ0-45åº¦ï¼‰ï¼šè´¨é‡å¾ˆå¥½ âœ…
  - OODåŒºåŸŸï¼ˆ45-90åº¦ï¼‰ï¼šè´¨é‡å¾ˆå·® âŒ
  - ç»“è®ºï¼šéªŒè¯äº†OODé—®é¢˜å­˜åœ¨

## å®žéªŒ2: Simple-Mixï¼ˆåŠ å°‘é‡OODæ•°æ®ï¼‰
- è®­ç»ƒæ—¶é—´ï¼šXå°æ—¶  
- è§‚å¯Ÿï¼š
  - IDåŒºåŸŸï¼šè´¨é‡ä¿æŒè‰¯å¥½ âœ…
  - OODåŒºåŸŸï¼šæ¯”Baselineæ”¹å–„ï¼Œä½†ä»ä¸å¤Ÿç†æƒ³ âš ï¸
  - ç»“è®ºï¼šç®€å•æ··åˆæœ‰å¸®åŠ©ï¼Œä½†ä¸è¶³ä»¥è§£å†³é—®é¢˜

## å®žéªŒ3: Oracleï¼ˆå…¨éƒ¨æ•°æ®ï¼‰
- è®­ç»ƒæ—¶é—´ï¼šXå°æ—¶
- è§‚å¯Ÿï¼šå…¨èŒƒå›´è´¨é‡éƒ½å¾ˆå¥½ âœ…

## æ€»ç»“
1. ç¡®è®¤äº†OODæ³›åŒ–é—®é¢˜çš„å­˜åœ¨å’Œä¸¥é‡æ€§
2. ç®€å•æ··åˆå°‘é‡OODæ•°æ®æœ‰ä¸€å®šæ”¹å–„
3. ä½†è¿™ç§æ”¹å–„ä¸å¤Ÿæ˜¾è‘—ï¼Œè¯´æ˜Žéœ€è¦æ›´sophisticatedçš„æ–¹æ³•
4. æœªæ¥å·¥ä½œï¼šè®¾è®¡æ›´å¥½çš„åˆ©ç”¨å°‘é‡OODæ•°æ®çš„ç­–ç•¥
EOF
```

---

## ðŸŽ“ **å®Œæ•´ç‰¹æ€§è¯´æ˜Ž**

æœ¬å®žéªŒä½¿ç”¨å®Œæ•´çš„**CcGAN-AVAR**é…ç½®ï¼š

1. **è‡ªé€‚åº”é‚»åŸŸï¼ˆAVARæ ¸å¿ƒï¼‰**
   ```bash
   --use_ada_vic --ada_vic_type hybrid --min_n_per_vic 30 --use_symm_vic
   ```

2. **è¾…åŠ©å›žå½’æŸå¤±**
   ```bash
   --use_aux_reg_branch --use_aux_reg_model
   --aux_reg_loss_type ei_hinge
   ```

3. **å¯†åº¦æ¯”ä¼°è®¡æ­£åˆ™åŒ–**
   ```bash
   --use_dre_reg --dre_lambda 1e-2
   ```

4. **è®­ç»ƒå¢žå¼º**
   ```bash
   --use_ema --use_amp --use_diffaug
   ```

---

## ðŸ“š **æ–‡æ¡£å¯¼èˆª**

- **README.md** â† ä½ åœ¨è¿™é‡Œï¼Œå¿«é€Ÿå¼€å§‹
- **å®žéªŒæŒ‡å—.md** - è¯¦ç»†çš„åŽŸç†å’Œåˆ†æž
- **ä½¿ç”¨è¯´æ˜Ž.txt** - è¯¦ç»†çš„æ“ä½œæ‰‹å†Œ
- **START_HERE.txt** - å…¥å£å¼•å¯¼

---

## ðŸš€ **çŽ°åœ¨å¼€å§‹**

```bash
# ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹è·¯å¾„
vim step1_train_aux_regression.sh

# ç¬¬äºŒæ­¥ï¼šå¼€å§‹è®­ç»ƒ
bash step1_train_aux_regression.sh
```

ç¥å®žéªŒé¡ºåˆ©ï¼ðŸŽ‰
